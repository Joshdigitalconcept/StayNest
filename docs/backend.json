{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the StayZen platform, whether they are a host or a guest.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "isHost": {
          "type": "boolean",
          "description": "Indicates if the user is a host."
        },
        "isGuest": {
          "type": "boolean",
          "description": "Indicates if the user is a guest."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "firstName",
        "lastName",
        "email",
        "isHost",
        "isGuest",
        "createdAt",
        "updatedAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Accessible only to the user themselves or an admin.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Indicates admin privileges. The existence of a document with a user ID in this collection grants admin access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user with admin privileges."
            }
          ]
        }
      },
      {
        "path": "/listings/{listingId}",
        "definition": {
          "entityName": "listing",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores property listings. Includes denormalized `ownerId` for authorization independence.",
          "params": [
            {
              "name": "listingId",
              "description": "The unique identifier of the listing."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the StayZen application, focusing on secure user authentication, property listings, search, booking, payments, messaging, and reviews. The structure emphasizes Authorization Independence by denormalizing authorization data where necessary, primarily using path-based ownership for user-related data and existence-based global roles.\n\n**Authorization Independence & QAPs:**\n\n*   **Users:** User profiles are stored under `/users/{userId}`, ensuring that only the authenticated user (or an admin) can access and modify their data. This eliminates the need for complex `get()` calls in security rules and supports secure `list` operations.\n\n*   **Global Roles:** Admin privileges are managed through the `/roles_admin/{uid}` collection. The existence of a document with the user's UID in this collection grants admin access, thus ensuring Authorization Independence.\n\n*   **Invariants:** Timestamps (`createdAt`, `updatedAt`) are automatically managed using server timestamps to guarantee integrity.\n\n*   **Listings:** Listings are stored in a top-level `/listings` collection. The `ownerId` is denormalized to the `listings` documents. The `ownerId` field is also used to query listings owned by a specific user. This enables secure `list` operations, allowing users to view their own listings.\n\nThe data structure is designed with structural segregation in mind, ensuring that each collection has a homogeneous security posture. This greatly simplifies the security rules, making them easier to understand, debug, and maintain."
  }
}