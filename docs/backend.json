{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the StayNest platform, whether they are a host or a guest.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "firstName": {
          "type": "string",
          "description": "The user's first name."
        },
        "lastName": {
          "type": "string",
          "description": "The user's last name."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "phone": {
          "type": "string",
          "description": "The user's phone number."
        },
        "profilePictureUrl": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "isHost": {
          "type": "boolean",
          "description": "Indicates if the user is a host."
        },
        "isGuest": {
          "type": "boolean",
          "description": "Indicates if the user is a guest."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was last updated.",
          "format": "date-time"
        },
        "favorites": {
          "type": "array",
          "description": "A list of listing IDs that the user has favorited.",
          "items": {
            "type": "string"
          }
        },
        "work": {
          "type": "string",
          "description": "The user's occupation."
        },
        "school": {
          "type": "string",
          "description": "The school or university the user attended."
        },
        "live": {
          "type": "string",
          "description": "The city or area where the user lives."
        },
        "about": {
          "type": "string",
          "description": "A short biography or introduction from the user."
        },
        "languages": {
          "type": "string",
          "description": "Languages the user speaks."
        },
        "born": {
          "type": "string",
          "description": "The decade the user was born in."
        },
        "obsessedWith": {
          "type": "string",
          "description": "Something the user is obsessed with."
        },
        "uselessSkill": {
          "type": "string",
          "description": "A fun, useless skill the user has."
        },
        "biographyTitle": {
          "type": "string",
          "description": "A creative title for the user's life story."
        },
        "favoriteSong": {
          "type": "string",
          "description": "The user's favorite song from high school."
        },
        "spendTooMuchTime": {
          "type": "string",
          "description": "Something the user spends a lot of time doing."
        },
        "funFact": {
          "type": "string",
          "description": "A fun fact about the user."
        },
        "pets": {
          "type": "string",
          "description": "Information about the user's pets."
        },
        "travelGoal": {
          "type": "string",
          "description": "A place the user has always wanted to travel to."
        }
      },
      "required": [
        "id",
        "email",
        "isHost",
        "isGuest",
        "createdAt",
        "updatedAt"
      ]
    },
    "listing": {
      "title": "Listing",
      "description": "Represents a property listing on the StayNest platform.",
      "type": "object",
      "properties": {
        "ownerId": {
          "type": "string",
          "description": "The UID of the user who owns this listing."
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "location": {
          "type": "string"
        },
        "pricePerNight": {
          "type": "number"
        },
        "cleaningFee": {
          "type": "number",
          "description": "A flat fee for cleaning the property after a stay."
        },
        "serviceFee": {
          "type": "number",
          "description": "A fee for using the StayNest platform."
        },
        "maxGuests": {
          "type": "number"
        },
        "bedrooms": {
          "type": "number"
        },
        "bathrooms": {
          "type": "number"
        },
        "amenities": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "imageUrl": {
          "type": "string",
          "format": "uri",
          "description": "The primary image URL for the listing."
        },
        "imageUrls": {
          "type": "array",
          "description": "A list of image URLs for the listing carousel.",
          "items": {
            "type": "string",
            "format": "uri"
          }
        }
      },
      "required": [
        "ownerId",
        "title",
        "description",
        "location",
        "pricePerNight",
        "maxGuests",
        "imageUrl",
        "imageUrls",
        "cleaningFee",
        "serviceFee"
      ]
    },
    "booking": {
      "title": "Booking",
      "description": "Represents a booking made by a guest for a listing.",
      "type": "object",
      "properties": {
        "listingId": {
          "type": "string",
          "description": "The ID of the booked listing."
        },
        "guestId": {
          "type": "string",
          "description": "The UID of the guest who made the booking."
        },
        "hostId": {
          "type": "string",
          "description": "The UID of the host who owns the listing."
        },
        "checkInDate": {
          "type": "string",
          "format": "date-time"
        },
        "checkOutDate": {
          "type": "string",
          "format": "date-time"
        },
        "totalPrice": {
          "type": "number"
        },
        "guests": {
          "type": "number"
        },
        "status": {
          "type": "string",
          "enum": [
            "pending",
            "confirmed",
            "declined"
          ]
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        }
      },
      "required": [
        "listingId",
        "guestId",
        "hostId",
        "checkInDate",
        "checkOutDate",
        "totalPrice",
        "guests",
        "status",
        "createdAt"
      ]
    },
    "favorite": {
      "title": "Favorite",
      "description": "Represents a user's favorited listing.",
      "type": "object",
      "properties": {
        "listingId": {
          "type": "string",
          "description": "The ID of the favorited listing."
        },
        "favoritedAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp indicating when the listing was favorited."
        }
      },
      "required": [
        "listingId",
        "favoritedAt"
      ]
    },
    "review": {
      "title": "Review",
      "description": "A review of a property listing by a user.",
      "type": "object",
      "properties": {
        "listingId": {
          "type": "string",
          "description": "The ID of the listing being reviewed."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user who wrote the review."
        },
        "rating": {
          "type": "number",
          "description": "A numerical rating from 1 to 5."
        },
        "comment": {
          "type": "string",
          "description": "The text content of the review."
        },
        "createdAt": {
          "type": "string",
          "format": "date-time",
          "description": "Timestamp indicating when the review was created."
        }
      },
      "required": [
        "listingId",
        "userId",
        "rating",
        "comment",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Accessible only to the user themselves or an admin.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/favorites/{listingId}",
        "definition": {
          "entityName": "favorite",
          "schema": {
            "$ref": "#/backend/entities/favorite"
          },
          "description": "Stores a user's favorite listings. Each document represents a single favorited item.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "listingId",
              "description": "The unique identifier of the listing."
            }
          ]
        }
      },
      {
        "path": "/roles_admin/{userId}",
        "definition": {
          "entityName": "roles_admin",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Indicates admin privileges. The existence of a document with a user ID in this collection grants admin access.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user with admin privileges."
            }
          ]
        }
      },
      {
        "path": "/listings/{listingId}",
        "definition": {
          "entityName": "listing",
          "schema": {
            "$ref": "#/backend/entities/listing"
          },
          "description": "Stores property listings. Includes denormalized `ownerId` for authorization independence.",
          "params": [
            {
              "name": "listingId",
              "description": "The unique identifier of the listing."
            }
          ]
        }
      },
      {
        "path": "/listings/{listingId}/reviews/{reviewId}",
        "definition": {
          "entityName": "review",
          "schema": {
            "$ref": "#/backend/entities/review"
          },
          "description": "Stores reviews for a specific listing.",
          "params": [
            {
              "name": "listingId",
              "description": "The unique identifier of the listing."
            },
            {
              "name": "reviewId",
              "description": "The unique identifier of the review."
            }
          ]
        }
      },
      {
        "path": "/bookings/{bookingId}",
        "definition": {
          "entityName": "booking",
          "schema": {
            "$ref": "#/backend/entities/booking"
          },
          "description": "Stores booking information. Guests can create bookings, and both guest and host can read them.",
          "params": [
            {
              "name": "bookingId",
              "description": "The unique identifier of the booking."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore data structure is designed to support the StayNest application, focusing on secure user authentication, property listings, search, booking, payments, messaging, and reviews. The structure emphasizes Authorization Independence by denormalizing authorization data where necessary, primarily using path-based ownership for user-related data and existence-based global roles.\n\n**Authorization Independence & QAPs:**\n\n*   **Users:** User profiles are stored under `/users/{userId}`, ensuring that only the authenticated user (or an admin) can access and modify their data. This eliminates the need for complex `get()` calls in security rules and supports secure `list` operations.\n\n*   **Global Roles:** Admin privileges are managed through the `/roles_admin/{uid}` collection. The existence of a document with the user's UID in this collection grants admin access, thus ensuring Authorization Independence.\n\n*   **Invariants:** Timestamps (`createdAt`, `updatedAt`) are automatically managed using server timestamps to guarantee integrity.\n\n*   **Listings:** Listings are stored in a top-level `/listings` collection. The `ownerId` is denormalized to the `listings` documents. The `ownerId` field is also used to query listings owned by a specific user. This enables secure `list` operations, allowing users to view their own listings.\n\n*   **Bookings:** Bookings are stored in a top-level `/bookings` collection. `guestId` and `hostId` are denormalized for authorization independence. This allows guests to see their bookings and hosts to see bookings for their properties without complex queries or rules.\n\n*   **Favorites:** Favorites are stored in a subcollection `users/{userId}/favorites/{listingId}`. This provides a scalable way to store a user's favorite listings. This structure allows for simple, secure queries and avoids the 'array-contains' limitations and the 1MB document size limit.\n\n* **Reviews:** Reviews are stored in a subcollection under each listing (`/listings/{listingId}/reviews/{reviewId}`). This scopes reviews to their respective listings, making them easy to query. Denormalized user information (name, photoURL) is stored on the review to avoid extra document reads when displaying reviews.\n\nThe data structure is designed with structural segregation in mind, ensuring that each collection has a homogeneous security posture. This greatly simplifies the security rules, making them easier to understand, debug, and maintain."
  }
}